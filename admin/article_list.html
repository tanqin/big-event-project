<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>æ–‡ç« åˆ—è¡¨</title>
    <link rel="stylesheet" href="./libs/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/iconfont.css" />
    <link rel="stylesheet" href="./css/main.css" />
    <!-- å¼•å…¥layuiçš„CSSæ–‡ä»¶ -->
    <link rel="stylesheet" href="./libs/layui/css/layui.css" />
    <script src="./libs/jquery/jquery.min.js"></script>
  </head>

  <body>
    <div class="container-fluid">
      <div class="common_title">æ–‡ç« åˆ—è¡¨</div>
      <div class="container-fluid common_con">
        <div class="row opt_btns">
          <div class="col-xs-6">
            <div class="form-inline">
              <input type="text" id="aname" class="form-control input-sm" placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜..." />
              <select id="selCategory" name="" class="form-control input-sm">
                <option value="">æ‰€æœ‰åˆ†ç±»</option>
                <!-- <option>æœªåˆ†ç±»</option>
                <option>å¥‡è¶£äº‹</option>
                <option>ä¼šç”Ÿæ´»</option>
                <option>çˆ±æ—…è¡Œ</option> -->
              </select>
              <select id="selStatus" name="" class="form-control input-sm">
                <option value="">æ‰€æœ‰çŠ¶æ€</option>
                <option value="è‰ç¨¿">è‰ç¨¿</option>
                <option value="å·²å‘å¸ƒ">å·²å‘å¸ƒ</option>
              </select>
              <button id="btnSearch" class="btn btn-default btn-sm">ç­›é€‰</button>
            </div>
          </div>
          <div class="col-xs-6">
            <a href="article_release.html" class="btn btn-success btn-sm pull-right" id="release_btn">å‘è¡¨æ–‡ç« </a>
          </div>
        </div>
        <table class="table table-striped table-bordered table-hover mp20">
          <thead>
            <tr>
              <th>æ ‡é¢˜</th>
              <th>ä½œè€…</th>
              <th>åˆ†ç±»</th>
              <th class="text-center">å‘è¡¨æ—¶é—´</th>
              <th class="text-center">çŠ¶æ€</th>
              <th class="text-center" width="100">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <!-- <tr>
              <td>ç‹ç§¯åƒé€ ç»Ÿæœ€å¤´</td>
              <td>æ°å…‹</td>
              <td>å¥‡è¶£äº‹</td>
              <td class="text-center">2017-06-08 07:08:46</td>
              <td class="text-center">å·²å‘å¸ƒ</td>
              <td class="text-center">
                <a href="article_edit.html" class="btn btn-default btn-xs">ç¼–è¾‘</a>
                <a href="javascript:void(0);" class="btn btn-danger btn-xs delete">åˆ é™¤</a>
              </td>
            </tr> -->
          </tbody>
        </table>
        <div class="row text-center" id="page-container"></div>
      </div>
    </div>
    <!-- å¼•å…¥layuiçš„js -->
    <script src="./libs/layui/layui.js"></script>
    <!-- å¼•å…¥è‡ªå®šä¹‰ajaxé…ç½®js -->
    <script src="./js/jqconfig.js"></script>
    <!-- step1ï¼šå¼•å…¥æ¨¡æ¿å¼•æ“js -->
    <script src="./libs/art-template/template-web.js"></script>
    <!-- step2ï¼šå®šä¹‰HTMLæ¨¡æ¿ -->
    <script id="list" type="text/html">
      {{each data}}
      <tr>
        <td>{{$value.title}}</td>
        <td>{{$value.author}}</td>
        <td>{{$value.category}}</td>
        <td class="text-center">{{$value.date}}</td>
        <td class="text-center">{{$value.state}}</td>
        <td class="text-center">
          <a href="article_edit.html" class="btn btn-default btn-xs">ç¼–è¾‘</a>
          <a href="javascript:void(0);" class="btn btn-danger btn-xs delete">åˆ é™¤</a>
        </td>
      </tr>
      {{/each}}
    </script>
    <!-- step2ï¼šå®šä¹‰HTMLæ¨¡æ¿ -->
    <script id="getCate" type="text/html">
      {{each data}}
      <option value="{{$value.id}}">{{$value.name}}</option>
      {{/each}}
    </script>
    <script>
      let laypage;
      let layer;
      //   ğŸˆ1.æ·»åŠ å’Œåˆ†é¡µæ¨¡å—
      layui.use(["laypage", "layer"], function () {
        laypage = layui.laypage;
        layper = layui.layer;
        getarticle(); //éœ€è¦åœ¨layuiåˆå§‹åŒ–ä¹‹åè°ƒç”¨ç”Ÿæˆæ•°æ®åˆ—è¡¨
        getCateList();
      });

      // ğŸˆ2. å°†æ–‡ç« æ¸²æŸ“åˆ°é¡µé¢ä¸­
      let params = { page: 1, perpage: 6 };
      function getarticle() {
        // 1.1 å‘é€ajaxè¯·æ±‚
        $.ajax({
          type: "get",
          url: "/admin/article/query",
          data: params,
          success: (res) => {
            // è·å–å¤±è´¥ï¼Œå¼¹å‡ºæç¤º
            if (res.code !== 200) layer.msg("åªæƒ³å¼±å¼±æç¤º", { time: 500 });

            // step3ï¼šè°ƒç”¨æ¨¡æ¿å¼•æ“
            let strHtml = template("list", res.data);

            // 1.2 å°†ç”Ÿæˆçš„æ¨¡æ¿æ¸²æŸ“åˆ°tbodyä¸­
            $("tbody").html(strHtml);

            // æ¸²æŸ“åˆ†é¡µæ ,æ·»åŠ åˆ°idä¸ºpage-containerçš„å®¹å™¨ä¸­
            laypage.render({
              elem: "page-container",
              count: res.data.totalCount, //æ•°æ®æ€»æ•°ï¼Œä»æœåŠ¡ç«¯å¾—åˆ°
              curr: params.page, //å½“å‰é¡µ
              jump: function (obj, first) {
                //objåŒ…å«äº†å½“å‰åˆ†é¡µçš„æ‰€æœ‰å‚æ•°ï¼Œæ¯”å¦‚ï¼š
                // console.log(obj.curr); //å¾—åˆ°å½“å‰é¡µï¼Œä»¥ä¾¿å‘æœåŠ¡ç«¯è¯·æ±‚å¯¹åº”é¡µçš„æ•°æ®ã€‚
                // console.log(obj.limit); //å¾—åˆ°æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°

                //é¦–æ¬¡ä¸æ‰§è¡Œ
                if (!first) {
                  // è·å–ç”¨æˆ·ç‚¹å‡»çš„é¡µç 
                  params.page = obj.curr;
                  getarticle();
                }
              },
            });
          },
        });
      }

      // ğŸˆ3. åŠ è½½æ‰€æœ‰æ–‡ç« ç±»åˆ«æ¨¡å—
      function getCateList() {
        $.ajax({
          type: "get",
          url: "/admin/category/list",
          success: (res) => {
            // console.log(res);
            if (res.code !== 200) return;

            let cateHtml = template("getCate", res);
            $("#selCategory").append(cateHtml);
          },
        });
      }

      //   ğŸˆ4. ç­›é€‰æ–‡ç« 
      // ç­›é€‰æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
      $("#btnSearch").click(function () {
        // è·å–ä¸‰ä¸ªå€¼ç­›é€‰æ–‡ç« 
        let key = $("#aname").val().trim();
        let type = $("#selCategory").val();
        let state = $("#selStatus").val();

        // console.log(key, type, state);//æˆåŠŸ
        params.key = key;
        params.type = type;
        params.state = state;

        // è°ƒç”¨å‡½æ•°ï¼Œè·å–æ–‡ç« 
        getarticle();
      });
    </script>
  </body>
</html>
